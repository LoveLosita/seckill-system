# 1.技术栈及其作用

本系统使用了如下技术栈，来应对一个抢购系统可能会出现的各种问题，以及实现其功能：

1. `go`：作为整个系统的编程语言。
2. `hertz`：作为网关，来连接前端和`rpc`。
3. `kitex`：作为`rpc`框架，处理并发操作，应对突发大流量访问，以及增强系统防挂能力。
4. `nginx`：负责负载均衡，将访问流量均匀分配到`kitex`客户端的多个进程。
5. `mysql`：作为数据库，存储商品、用户等的信息。
6. `redis`：用于缓存商品状态、原子扣减库存、用户抢购标记、接口层加速和预处理。在内存中处理预购买，用户只需要几毫秒就能收到返回的消息。
7. `kafka`：作为消息队列框架，起到削峰的作用。将消息放入队列，后端再一条一条处理。
8. `gorm`：使用它来更方便操作数据库。

# 2.抢购流程

## 2.1.抢购开始前

将库存提前预热到`redis`中缓存，若此时有抢购请求，返回未开始。

## 2.2.抢购开始后

请求回路：客户->`Hertz&Kitex`客户端网关->`Kitex`服务端->进入`dao`层，进行`redis`缓存击中->在`redis`中使用原子操作扣减库存->向客户返回下单成功，订单正在处理，以及订单号/下单失败，库存不足->成功的订单进入`kafka`队列->被`kafka`消费者监听到->执行业务逻辑，在`mysql`中进行库存扣减操作，并将订单号和下单状态插入数据库，供用户查询。

在拿到订单号后，可以使用查询订单接口，使用订单号查询订单下单状态，除非内部错误或者因`redis`原子锁失效而引起的超售，一般都是成功。

由于为小demo，~~懒得~~无余力设计用户级别分层系统，故设定为已登录用户为商城管理员，未登录的游客即可购买商品。

## 2.3.抢购结束后

撤掉`redis`中的缓存，若仍然有请求，返回无库存。

# 3.接口文档

# 4.返回定义

# 5.快速开始

